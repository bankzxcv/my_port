---
import BlogLayout from '../../layouts/BlogLayout.astro';
import CategoryBadge from '../../components/blog/CategoryBadge.astro';
import RelatedPosts from '../../components/blog/RelatedPosts.astro';
import { getAllPosts, formatDate } from '../../lib/blogUtils';
import type { BlogPost } from '../../lib/types';

export async function getStaticPaths() {
  const posts = getAllPosts();
  return posts.map(post => ({
    params: { slug: post.slug },
    props: { post }
  }));
}

interface Props {
  post: BlogPost;
}

const { post } = Astro.props;
---

<BlogLayout post={post}>
  <article>
    <!-- Header -->
    <header class="mb-8">
      <div class="mb-4">
        <CategoryBadge category={post.category} />
      </div>

      <h1 class="text-4xl md:text-5xl font-bold mb-4 bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent" data-aos="fade-up">
        {post.title}
      </h1>

      <div class="flex items-center gap-4 text-gray-600" data-aos="fade-up" data-aos-delay="100">
        <img
          src={post.author.avatar}
          alt={post.author.name}
          class="w-12 h-12 rounded-full"
        />
        <div>
          <p class="font-medium text-gray-900">{post.author.name}</p>
          <div class="flex items-center gap-3 text-sm">
            <time datetime={post.publishedDate}>
              {formatDate(post.publishedDate)}
            </time>
            <span>·</span>
            <span>{post.readTime} min read</span>
          </div>
        </div>
      </div>
    </header>

    <!-- Featured Image -->
    {post.featuredImage && (
      <img
        src={post.featuredImage.url}
        alt={post.featuredImage.alt}
        class="w-full h-auto rounded-xl shadow-xl mb-8"
        data-aos="fade-up"
      />
    )}

    <!-- Content -->
    <div
      class="blog-content prose prose-lg max-w-none mb-12 bg-white/80 backdrop-blur-sm rounded-xl p-8 shadow-lg"
      data-aos="fade-up"
      set:html={post.content}
    />

    <!-- Tags -->
    <div class="flex flex-wrap gap-2 mb-12" data-aos="fade-up">
      {post.tags.map(tag => (
        <a
          href={`/blog/tag/${tag.toLowerCase()}`}
          class="px-4 py-2 bg-blue-100 text-blue-700 rounded-full hover:bg-blue-200 transition-colors"
        >
          #{tag}
        </a>
      ))}
    </div>

    <!-- Share Section -->
    <div class="border-t border-b border-gray-200 py-6 mb-12 bg-white/60 backdrop-blur-sm rounded-xl px-6" data-aos="fade-up">
      <p class="text-center text-gray-600 mb-3">Share this article</p>
      <div class="flex justify-center gap-4">
        <a
          href={`https://twitter.com/intent/tweet?text=${encodeURIComponent(post.title)}&url=${Astro.url}`}
          target="_blank"
          rel="noopener noreferrer"
          class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors"
        >
          Twitter
        </a>
        <a
          href={`https://www.linkedin.com/sharing/share-offsite/?url=${Astro.url}`}
          target="_blank"
          rel="noopener noreferrer"
          class="px-4 py-2 bg-blue-700 text-white rounded-lg hover:bg-blue-800 transition-colors"
        >
          LinkedIn
        </a>
      </div>
    </div>
  </article>

  <!-- Related Posts -->
  <RelatedPosts currentPost={post} />

  <!-- Back to Blog -->
  <div class="text-center mt-12">
    <a
      href="/blog"
      class="inline-flex items-center gap-2 text-blue-600 hover:text-blue-800 font-medium"
    >
      ← Back to all posts
    </a>
  </div>
</BlogLayout>

<style>
  .blog-content :global(h2) {
    @apply text-3xl font-bold mt-8 mb-4 text-gray-900;
  }

  .blog-content :global(h3) {
    @apply text-2xl font-semibold mt-6 mb-3 text-gray-800;
  }

  .blog-content :global(p) {
    @apply mb-4 leading-relaxed text-gray-700;
  }

  .blog-content :global(ul),
  .blog-content :global(ol) {
    @apply mb-4 ml-6 space-y-2;
  }

  .blog-content :global(ul) {
    @apply list-disc;
  }

  .blog-content :global(ol) {
    @apply list-decimal;
  }

  .blog-content :global(li) {
    @apply text-gray-700;
  }

  .blog-content :global(code) {
    @apply bg-gray-100 px-2 py-1 rounded text-sm font-mono text-gray-800;
  }

  .blog-content :global(pre) {
    @apply bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto mb-4;
  }

  .blog-content :global(pre code) {
    @apply bg-transparent p-0 text-gray-100;
  }

  .blog-content :global(blockquote) {
    @apply border-l-4 border-blue-500 pl-4 italic my-4 text-gray-600;
  }

  .blog-content :global(strong) {
    @apply font-semibold text-gray-900;
  }

  .blog-content :global(a) {
    @apply text-blue-600 hover:text-blue-800 underline;
  }
</style>
